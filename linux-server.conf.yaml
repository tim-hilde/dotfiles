- defaults:
    link:
      relink: true
      create: true
    force: true

    $HOME/.aliases:
      path: linux-server/aliases
      relative: true
    $HOME/.zshrc:
      path: linux-server/zshrc
      relative: true
    $HOME/.gitconfig:
      path: linux-server/gitconfig
      relative: true
    $HOME/.config/tmux:
      path: linux-server/tmux
      relative: true
      create: true
    $HOME/.config/nvim:
      path: linux-server/nvim
      relative: true
      create: true
    $HOME/.config/bat:
      path: linux-server/bat
      relative: true
      create: true
    $HOME/.config/starship.toml:
      path: linux-server/starship.toml
      relative: true

- shell:
  # Update system packages
  - command: |
      if command -v apt >/dev/null 2>&1; then
        sudo apt update && sudo apt upgrade -y
      elif command -v dnf >/dev/null 2>&1; then
        sudo dnf update -y
      elif command -v pacman >/dev/null 2>&1; then
        sudo pacman -Syu --noconfirm
      fi
    description: Updating system packages
    quiet: true

  # Install essential packages
  - command: |
      if command -v apt >/dev/null 2>&1; then
        sudo apt install -y zsh git curl wget tmux neovim python3 python3-pip \
          build-essential fd-find ripgrep fzf jq tree unzip htop direnv bat
      elif command -v dnf >/dev/null 2>&1; then
        sudo dnf install -y zsh git curl wget tmux neovim python3 python3-pip \
          @development-tools fd-find ripgrep fzf jq tree unzip htop direnv bat
      elif command -v pacman >/dev/null 2>&1; then
        sudo pacman -S --noconfirm zsh git curl wget tmux neovim python python-pip \
          base-devel fd ripgrep fzf jq tree unzip htop direnv bat
      fi
    description: Installing essential packages
    quiet: true

  # Install eza (modern ls replacement)
  - command: |
      if command -v apt >/dev/null 2>&1; then
        sudo apt install -y gpg
        sudo mkdir -p /etc/apt/keyrings
        wget -qO- https://raw.githubusercontent.com/eza-community/eza/main/deb.asc | sudo gpg --dearmor -o /etc/apt/keyrings/gierens.gpg
        echo "deb [signed-by=/etc/apt/keyrings/gierens.gpg] http://deb.gierens.de stable main" | sudo tee /etc/apt/sources.list.d/gierens.list
        sudo chmod 644 /etc/apt/keyrings/gierens.gpg /etc/apt/sources.list.d/gierens.list
        sudo apt update && sudo apt install -y eza
      elif command -v cargo >/dev/null 2>&1; then
        cargo install eza
      else
        echo "Skipping eza installation - no suitable package manager found"
      fi
    description: Installing eza
    quiet: true
    stderr: true

  # Install zoxide (smart cd)
  - command: curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash
    description: Installing zoxide
    quiet: true

  # Change default shell to zsh
  - command: sudo chsh -s $(which zsh) $USER
    description: Setting zsh as default shell
    quiet: true

  # Install oh-my-zsh
  - command: |
      if [[ ! -d "$HOME/.oh-my-zsh" ]]; then
        RUNZSH=no CHSH=no sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
      fi
    description: Installing oh-my-zsh
    quiet: true

  # Install essential zsh plugins
  - command: |
      if [[ ! -d "$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting" ]]; then
        git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
      fi
    description: Installing zsh syntax highlighting
    quiet: true

  - command: |
      if [[ ! -d "$HOME/.oh-my-zsh/custom/plugins/zsh-autosuggestions" ]]; then
        git clone https://github.com/zsh-users/zsh-autosuggestions.git $HOME/.oh-my-zsh/custom/plugins/zsh-autosuggestions
      fi
    description: Installing zsh autosuggestions
    quiet: true

  # Install minimal starship prompt instead of powerlevel10k
  - command: curl -sS https://starship.rs/install.sh | sh -s -- -y
    description: Installing starship prompt
    quiet: true

  # Update pip and install common Python packages
  - command: python3 -m pip install --user --upgrade pip setuptools wheel
    description: Updating pip and installing basic packages
    quiet: true

  # Build bat cache
  - command: bat cache --build
    quiet: true
    stderr: true